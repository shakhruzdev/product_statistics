{% extends 'apps/base.html' %}
{% load static %}
{% block css_link %}
    <link rel="stylesheet" href="{% static 'apps/css/clients.css' %}">
{% endblock %}
{% block content %}
    <main class="main">
        <div class="form-row">
            <button class="add-btn" onclick="openModal()">+ –î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</button>
        </div>
        <div id="modal" class="modal">
            <div class="modal-content">
                <span class="close" onclick="closeModal()">&times;</span>
                <h2>–î–æ–±–∞–≤–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
                <form id="clientForm" method="post" action="{% url 'client_list' %}">
                    {% csrf_token %}
                    {% if form.non_field_errors %}
                        <div class="error-message">
                            {{ form.non_field_errors.0 }}
                        </div>
                    {% endif %}
                    <label>–ò–º—è:</label>
                    {{ form.full_name.errors }}
                    <input type="text" name="full_name" oninput="this.value = this.value.replace(/[^A-Za-z]/g, '')">
                    <label for="id_phone_number">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                    {{ form.phone_number.errors }}
                    <input type="tel" id="phone_number" name="phone_number" maxlength="12" required
                           placeholder="+7XXXXXXXXXX" value="{{ form.phone_number.value|default:'+7' }}">
                    <span id="phone-error" style="color:red;"></span>

                    <button type="submit" class="save-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                    <button type="button" class="cancel-btn" onclick="closeModal()">–û—Ç–º–µ–Ω–∏—Ç—å</button>
                </form>
            </div>
        </div>

        <table class="client-table">
            <thead>
            <tr>
                <th>‚Ññ</th>
                <th>–ò–º—è</th>
                <th>–¢–µ–ª–µ—Ñ–æ–Ω</th>
                <th>–î–µ–π—Å—Ç–≤–∏—è</th>
            </tr>
            </thead>
            <tbody>
            {% for client in clients %}
                <tr>
                    <td>{{ client.id }}</td>
                    <td>{{ client.full_name }}</td>
                    <td>{{ client.phone_number }}</td>
                    <td>
                        <button class="icon-btn update" title="–ò–∑–º–µ–Ω–∏—Ç—å"
                                onclick="openUpdateModal(this)"
                                data-client-id="{{ client.id }}"
                                data-client-name="{{ client.full_name }}"
                                data-client-phone="{{ client.phone_number }}"
                                data-update-url="{% url 'client_update' client.id %}">
                            ‚úèÔ∏è
                        </button>
                        <button class="icon-btn delete" title="–£–¥–∞–ª–∏—Ç—å"
                                onclick="openDeleteModal(this)"
                                data-client-id="{{ client.id }}"
                                data-client-name="{{ client.full_name }}">
                            üóë
                        </button>
                    </td>
                </tr>
            {% endfor %}

            </tbody>
        </table>
    </main>

    <div id="updateModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeUpdateModal()">&times;</span>
            <h2>–†–µ–¥–∞–∫—Ç–∏—Ä–æ–≤–∞—Ç—å –∫–ª–∏–µ–Ω—Ç–∞</h2>
            <form id="updateForm" method="POST">
                {% csrf_token %}Ôøº
                <label for="full_name">–§–ò–û:</label>
                <input type="text" id="full_name" name="full_name"
                       oninput="this.value = this.value.replace(/[^A-Za-z]/g, '')" required>
                {{ form.full_name.errors }}
                <label for="phone_number">–¢–µ–ª–µ—Ñ–æ–Ω:</label>
                {{ form.phone_number.errors }}
                <input type="tel" id="phone_number" name="phone_number" maxlength="12" required
                       placeholder="+7XXXXXXXXXX" value="{{ form.phone_number.value|default:'+7' }}">
                <span id="phone-error" style="color:red;"></span>

                <button type="submit" class="update-btn">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</button>
                <button type="button" class="cancel-btn" onclick="closeUpdateModal()">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>


    <div id="deleteModal" class="modal">
        <div class="modal-content">
            <span class="close" onclick="closeDeleteModal()">&times;</span>
            <h2>–£–¥–∞–ª–µ–Ω–∏–µ –∫–ª–∏–µ–Ω—Ç–∞</h2>
            <p id="deleteText">–í—ã —É–≤–µ—Ä–µ–Ω—ã, —á—Ç–æ —Ö–æ—Ç–∏—Ç–µ —É–¥–∞–ª–∏—Ç—å –∫–ª–∏–µ–Ω—Ç–∞?</p>
            <form id="deleteForm" method="POST">
                {% csrf_token %}
                <button type="submit" class="delete-btn">–î–∞, —É–¥–∞–ª–∏—Ç—å</button>
                <button type="button" class="cancel-btn" onclick="closeDeleteModal()">–û—Ç–º–µ–Ω–∞</button>
            </form>
        </div>
    </div>
    {% if form.errors %}
        <script>
            window.addEventListener("DOMContentLoaded", function () {
                openModal();
            });
        </script>
    {% endif %}
    {% block extra_js %}
        <script src="{% static 'apps/js/clients.js' %}"></script>
    {% endblock %}
{% endblock %}